CREATE DATABASE gategourmet;
use gategourmet;

CREATE TABLE usuarios (
    documento INT PRIMARY KEY,
    nombre_usuario VARCHAR(50) NOT NULL,
    contrasena VARCHAR(255) NOT NULL,
    correo VARCHAR(100) NOT NULL UNIQUE,
    nombres_apellidos VARCHAR(100) NOT NULL,
    area VARCHAR(50) NOT NULL,
    cargo VARCHAR(50) NOT NULL,
    rol ENUM('Administrador', 'Supervisor', 'Empleado') NOT NULL,
    estado ENUM('Activo', 'Inactivo') DEFAULT 'Inactivo'
);


CREATE TABLE administradores (
    documento INT PRIMARY KEY,
    nombre_usuario VARCHAR(50) NOT NULL,
    contrasena VARCHAR(255) NOT NULL,
    correo VARCHAR(100) NOT NULL,
    nombres_apellidos VARCHAR(100) NOT NULL,
    area VARCHAR(50) NOT NULL,
    cargo VARCHAR(50) NOT NULL,
    rol ENUM('Administrador') NOT NULL,
    estado ENUM('Activo', 'Inactivo') DEFAULT 'Inactivo'
);


CREATE TABLE cargos (
    id int(11) NOT NULL AUTO_INCREMENT,
    nombre_cargo varchar(255) NOT NULL,
    PRIMARY KEY (id),
    UNIQUE (nombre_cargo)
);

CREATE TABLE roles (
    id int(11) NOT NULL AUTO_INCREMENT,
    nombre_rol varchar(255) NOT NULL,
    PRIMARY KEY (id),
    UNIQUE (nombre_rol)
);

CREATE TABLE documentos (
    id int(11) NOT NULL AUTO_INCREMENT,
    codigo varchar(50) NOT NULL,
    tipo_documento enum('Word', 'Excel', 'PDF', 'PowerPoint', 'Texto', 'Otro') NOT NULL,
    estado enum('Activo', 'Inactivo', 'Pendiente', 'Archivado') NOT NULL,
    fecha_creacion timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
    fecha_modificacion timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);

CREATE TABLE listado_maestro (
    id INT AUTO_INCREMENT PRIMARY KEY,
    proceso VARCHAR(255),
    codigo VARCHAR(255),
    titulo_documento VARCHAR(255),
    tipo VARCHAR(255),
    version VARCHAR(50),
    estado VARCHAR(50),
    fecha_aprobacion DATE,
    areas TEXT,
    motivo_del_cambio TEXT,
    tiempo_de_retencion VARCHAR(255),
    responsable_de_retencion VARCHAR(255),
    lugar_de_almacenamiento_fisico TEXT,
    lugar_de_almacenamiento_magnetico TEXT,
    conservacion TEXT,
    disposicion_final TEXT,
    copias_controladas TEXT,
    fecha_de_vigencia DATE,
    dias INT,
    senal_alerta VARCHAR(50),
    obsoleto TINYINT(1),
    anulado TINYINT(1),
    en_actualizacion TINYINT(1)
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;


CREATE TABLE log_eventos (
    id_evento INT AUTO_INCREMENT PRIMARY KEY,
    documento INT,
    fecha TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    detalle TEXT,
    FOREIGN KEY (documento) REFERENCES usuarios(documento) ON DELETE CASCADE
);

CREATE TABLE password_resets (
    id_password INT(11) NOT NULL AUTO_INCREMENT,
    correo VARCHAR(100) NOT NULL,  
    token VARCHAR(255) NOT NULL,  
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id_password),
    FOREIGN KEY (correo) REFERENCES usuarios(correo) ON DELETE CASCADE
);


LOAD DATA INFILE 'C:/Users/Administrator/Desktop/Libro6.csv' 
INTO TABLE listado_maestro
FIELDS TERMINATED BY ';'
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS
(proceso, codigo, titulo_documento, tipo, version, estado, fecha_aprobacion, areas, motivo_del_cambio, tiempo_de_retencion, responsable_de_retencion, lugar_de_almacenamiento_fisico, lugar_de_almacenamiento_magnetico, conservacion, disposicion_final, copias_controladas, fecha_de_vigencia, dias, senal_alerta, obsoleto, anulado, en_actualizacion);

CREATE TABLE procesos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    macroproceso VARCHAR(255),
    proceso VARCHAR(255),
    usuario VARCHAR(255),
    cargo VARCHAR(255),
    email VARCHAR(255),
    rol VARCHAR(255)
);

LOAD DATA INFILE 'C:/Users/Administrator/Desktop/Libro1.csv' 
INTO TABLE procesos
FIELDS TERMINATED BY ';'
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(@macroproceso, @proceso, @usuario, @cargo, @email, @rol)
SET 
    macroproceso = TRIM(BOTH FROM @macroproceso),
    proceso = TRIM(BOTH FROM @proceso),
    usuario = TRIM(BOTH FROM @usuario),
    cargo = TRIM(BOTH FROM @cargo),
    email = TRIM(BOTH FROM @email),
    rol = TRIM(BOTH FROM @rol);



    
<!-- //C:\\Users\\lrodriguezcorrea\\Desktop\\Libro6.csv' -->

